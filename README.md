# 工程简介
IP隧道服务，用于公司内部爬虫服务的请求代理IP的管理，分发和分配，优质ip筛选，并发数限制。



# 需求分析
现在购买的第三方代理服务，会通过第三方接口返回对应的代理的ip和port，进而实现爬虫服务使用不同的代理IP去爬取数据。
但是随着够买的第三方代理越来越多，有点难以管理，所以需要构建一个IP隧道服务，进而实现代理ip的统一管理，和动态分配。



# 核心思路分析
该隧道服务需要把公司内部的服务请求（connect请求），通过这个隧道服务转发出去，把请求的header line，header，body按照原封不动的形式，传输给第三方代理的ip，port，代理服务商就会帮我们去直接获取目标地址的资源，然后返回给我的隧道服务，最后再响应数据给公司的内部服务
> 注意:
遇到的所有请求肯定都是connect代理请求，这些connect请求本身肯定有proxy认证信息，有访问的目标域名，端口，header信息。
不能直接转发这个请求给第三方代理商，需要重新构造一个代理请求发送给代理商。因为认证信息不一样。



# 需求补充（以服务健壮性为重心）



## 负载均衡

1.首先需要部署多个服务实例，每个实例就是一条隧道，将隧道服务做成分布式的，当大量的请求过来后，我们可以借用nginx的负载均衡（或者LVS做TCP层面的负载均衡），将这些请求均匀地路由分配到不同的服务实例上。



## 单进程多隧道
在proxy-server前面加一层springboot(ps：自带web容器)进行管理, 包括创建以下管理信息：
- 需要创建多少个proxy-server实例（对应就是多少条隧道）

- 每个实例的名称，ip，端口，部署的机器位置，需要cpu的核数，内存的总量，网络带宽的总量

- 每个实例需要创建多少boss线程数，worker线程数，连接时的用户名密码，缓存的代理ip总数，每个ip的有效时间，定时任务更新IP池的cron表达式

  

## 隧道初始化
1.初始化建立隧道的时候，需要根据mysql的配置信息进行创建，但是创建出来的所有隧道服务实例消耗的总带宽，不能超过机器带宽的80%，剩下的做备用。
2.根据mysql隧道实例配置列表，创建一个proxy server，监听一个独立的端口
3.隧道动态分配: 后续考虑使用 xxl-job做任务调度，实现根据下发的创建任务进行一个新的隧道的创建

> 注意：1.隧道实例的个数不能随意增加，减少，因为运维分配的端口只有10个(21330-21339)  2.目前也暂不支持隧道的动态创建（根据下发的创建任务进行new一个新的隧道）



## 业务线程安全机制

1.原则上，每条隧道会有一个初始化的线程池，所有的业务请求都会放入队列中，考虑到请求的时效性，每个线程一般处理3个代理请求任务，一定不能让队列有任务积压。那么1000个并发请求，需要设置核心线程数约为350，最大线程数500。业务线程在处理每一个代理请求的时候，需要对慢请求做超时处理（规定3秒钟为超时），放入到一个超时任务队列中（具有优先级的那种），并用单独的线程进行重试，重试3次无果，即返回超时等待的结果。

**超时时间：**

**超时参数配置**。需要根据每个服务的需求，做动态配置，因为有一些视频传输的特殊场景。

**慢请求线程处理。**比方说有500个线程，其中有10%数量的线程，都在处理慢请求。如果这些慢请求的线程超过10%的比例，需要主动中断处理慢请求的线程。防止后续的请求任务积压在队列中，影响其他请求。

**超时时间的设置。**后端重试次数乘以后端的超时时间，不能超过前端总的超时时间。



## ip池更新机制
- [ ] 一般来说，默认会5 min 拉取一次IP，注入到ip池中, ip池的数量会根据mysql配置参数来决定，默认10个（动态配置）。
- [x] 当ip池的数量过低，低于了30%，需要提前触发ip的拉取，不受时间间隔限制。
- [x] 当ip池的数量过高（每个隧道对应ip池的ip个数不能超过10个），需要取消ip的拉取。

**补充：**

**为了服务稳定，ip池的数量，必须全满，不能是动态变化的。**

**ip池的数量x(24hx60min/ip存活时间（分钟）)，小于代理商的每天的IP数量限制。 所以 IP总消耗量不能超过代理商每天分配的数量**

```
// ip_pool_num*((24h*60)/ip_ttl) < ip_total
// 现在暂时不用考虑这个问题，因为ZhiMaService的拉取速率不会超过每天的数量限制。
```



## ip自动检测
- [ ] ip利用率的检测：每个ip的使用率需要做统计，在从IP池提取ip去处理请求的时候，需要对ip的引用次数做记录，防止大量请求只打到某几个ip上，导致其他ip没有使用，或使用率很低。
- [ ] ip质量检测：每个IP都有一个失效时间，为了提高ip的利用率，我们需要设置一个ip监控线程，在ip失效的前5s检查出来，并进行剔除。某个ip在首次使用后，会超时或失败，需要重试，重试3次过后都不行，会记录失败次数，导致成功率很低。这时就需要通过ip打分机制，将这个ip的权重降低，同时使用率也需要减少。然后会生成一个ip质量有序列表，最后由ip池监控线程将列表末尾的20%剔除掉。（**ps: 需要根据实际执行的日志分析得出结果，再决定如何剔除，因为可能会出现一种极端情况，大量的ip都是低质量的ip，如果全部剔除就会影响服务**）
- [ ] ip打分机制：可以参考elasticsearch的权重打分机制。



## 流量控制
- [x] 需要对每个隧道的并发量做控制，都在1000左右。具体的请求数量限制，由服务器带宽，ip池数量，业务线程可用数量，综合决定，做一个动态的控制。(**ps: 每个隧道的并发量的控制，现在暂时设成固定的1000或者500**)
- [x] 所有的隧道消耗的带宽，加起来不能超过机器总带宽的80%。每条隧道初始化10MB（**ps：暂时不用考虑，因为部署的服务所在的机器，都是一些千兆网卡，公司内部服务的所有请求过来，基本上也不会超过其设定的值。**）



## 日志记录

日志需要清晰的记录转发过程：来源ip，来源请求类型，使用的哪个隧道服务，使用的哪个代理ip，请求的响应结果如何，请求耗时多长，请求超时或错误的具体原因信息。



# 服务部署

```shell
机器地址：61-> adx-crawl-007   172.18.211.168  120.25.162.186   16/32G
部署路径：/usr/local/htdocs/tunnel-proxy
日志路径：/data0/logs/tunnel-proxy
启动参数：-Dspring.profiles.active=product -Dserver.port=21330
端口使用：21330~21339   #这10个端口是规划给 tunnel-proxy 这个服务的
```



## 注意

1.根据MySQL初始化不同的隧道列表，每条隧道对应都有一个代理ip环形队列作为ip池（注意：芝麻代理的每个ip获取都是根据你的本机器的ip来计算的，
不同的机器ip请求获取的时候，代理IP的可用个数会对应减1，相同的ip获取的时候，只会当作一个）



# AB测试

ab -n 1000 -c 1 http://13.209.21.196:8080/trade-server/test/order/testQueue



# 问题记录

### 线上大量请求后，代理 ip 报出connect time out

- 第一步，使用代理ip和非代理ip的方式，在本地压测百度，新浪，查看区别
  本地直接请求百度：1000个线程，超过1000个会报socket closed，read timed out，EOFException异常

  代理ip请求百度：1000个线程就会报, connection timed out()

- 第二部，如果对比后发现代理IP有问题，就调整线程数，查看最大值是多少
- 第三步，使用代理ip下，每5秒，打印每个ip的使用次数，成功次数，失败次数，带宽大小



Apn-Proxy纯netty支持和Tunnel-Proxy业务线程池的增强，在相同并发下，进行压力测试



# 常见错误

Unexpected response code for CONNECT: 401

表示没有权限，或者ip时间已经过期

unexpected end of stream on https://mi.gdt.qq.com/...=9,

网络波动，或者请求连接时间设置的不合理

Remote host closed connection during handshake

time_wait 

# 稳定性修复

- 错误

```
ForwardRequestTask forward_handler 连接代理IP [221.10.104.151:4231(2022-04-19 20:20:52)] 失败 100
DirectRelayHandler exceptionCaught Connection reset by peer 107
```

- 解决步骤

1.使用隔离的独享ip测试出，单个ip的并发和带宽上限。

2.根据这个上限，以及调用方的请求数量，请求包量的大小，调整IP池的数量大小，使得请求的成功率在95%以上

3.后续再做做隧道的风控，频率控制

- 结论

```
测试访问 https://www.baicu.com，返回的数据大小345kb
单个ip的带宽在并发30左右得出的情况：(345kb*30)/1024 约等于10MB左右
所以隧道服务在规划ip的时候，应该遵循这个公式：单个ip的请求数量*每个请求的平均大小包量 <= 8MB（ps:不取10MB是因为，留下20%的缓冲空间，为了预防突发情况，比如网络抖动）。
如果现在需要满足1000/s的并发，每个请求的大小设定15000字节，每秒需要响应传输的数据大小是500000KB，如果按照单个ip可承载 8MB 算，应该满足以下公式：
    每分钟1000个请求 * 每次传输的数据报文大小（15000/1024=14.6KB）< 8MB * 1024 * ip池的数量。
所以算出ip池的数量为：2（按照3个ip算，用一个ip做意外缓冲）
// 最终出一个模糊的概念：1000并发 20KB 3个ip

优量广告每小时的请求量：15W，按照20W算，计算出每秒中56个请求，按照100个来算。每个请求大小：1 kb，按2KB算。响应大小：21 kb，按40KB算 
```





# 隧道测试

### 本地测试

```
// 测试参数：https://www.baidu.com 每个线程2个任务
并发：200, 成功=343, 失败=57, 失败率=14.25%, 错误原因列表：{SSL peer shut down incorrectly=4, Read timed out=3, timeout=50}
并发：300, 成功=473, 失败=127, 失败率=21.17%, 错误原因列表：{SSL peer shut down incorrectly=10, Read timed out=5, timeout=101}

// 优量广告测试地址：https://mi.gdt.qq.com/gdt_mview.fcg?posid=5000155655915649& 每个线程2个任务
并发：200, 成功=400, 失败=0, 失败率=0%, 错误原因列表：{}
并发：300, 成功=600, 失败=0, 失败率=0%, 错误原因列表：{}
并发：400, 成功=800, 失败=0, 失败率=0%, 错误原因列表：{}
并发：500, 成功=999, 失败=1, 失败率=0.1%, 错误原因列表：{Read timed out=1}
并发：600, 成功=1197, 失败=3, 失败率=0.25%, 错误原因列表：{Read timed out=2, timeout=1}
并发：700, 成功=789, 失败=611, 失败率=43.64%, 错误原因列表：{Read timed out=393, timeout=204}
```



### 线上测试

```
并发：300, 成功=480, 失败=120, 失败率=20%, 错误原因列表：{Read timed out=41, unexpected end of stream on https://mi.gdt.qq.com/...=30, timeout=49}
并发：400, 成功=280, 失败=120, 失败率=30%, 错误原因列表：{Read timed out=100, timeout=20}
并发：500, 成功=350, 失败=100, 失败率=20%, 错误原因列表：{Read timed out=57, timeout=43}
并发：600, 成功=367, 失败=233, 失败率=38.83%, 错误原因列表：{Read timed out=68, unexpected end of stream on https://mi.gdt.qq.com/...=119, timeout=46}
```



# 代理商账号密码

```
// 芝麻
username: seonzhang
password: 12345678
// 云代理
地址：http://console.v4.dailiyun.com/user/admin.html
username: 15779457681
password: gjb970312
//增加本地白名单 119.139.198.180
```



# 服务商ip质量测试

## 芝麻

#### 直连ip

##### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=59.59.85.236:4213(2022-04-21 12:12:49), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=59.59.85.236:4213(2022-04-21 12:12:49), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=59.59.85.236:4213(2022-04-21 12:12:49), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=59.59.85.236:4213(2022-04-21 12:12:49), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=59.59.85.236:4213(2022-04-21 12:12:49), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：61s
----------------------- 并发数：20 ------------------------
IP=120.39.142.134:4232(2022-04-21 12:25:53), 并发=20, 成功=96, 失败=4, 失败率=4%, 平均响应报文大小=331 kb
IP=120.39.142.134:4232(2022-04-21 12:25:53), 并发=20, 成功=93, 失败=7, 失败率=7%, 平均响应报文大小=321 kb
IP=120.39.142.134:4232(2022-04-21 12:25:53), 并发=20, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=120.39.142.134:4232(2022-04-21 12:25:53), 并发=20, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=120.39.142.134:4232(2022-04-21 12:25:53), 并发=20, 成功=95, 失败=5, 失败率=5%, 平均响应报文大小=328 kb
并发数：20, 耗时：94s
----------------------- 并发数：30 ------------------------
IP=125.111.146.84:4205(2022-04-21 12:27:27), 并发=30, 成功=3, 失败=147, 失败率=98%, 平均响应报文大小=6 kb
IP=125.111.146.84:4205(2022-04-21 12:27:27), 并发=30, 成功=8, 失败=142, 失败率=94.67%, 平均响应报文大小=18 kb
IP=125.111.146.84:4205(2022-04-21 12:27:27), 并发=30, 成功=3, 失败=147, 失败率=98%, 平均响应报文大小=6 kb
IP=125.111.146.84:4205(2022-04-21 12:27:27), 并发=30, 成功=5, 失败=145, 失败率=96.67%, 平均响应报文大小=11 kb
IP=125.111.146.84:4205(2022-04-21 12:27:27), 并发=30, 成功=4, 失败=146, 失败率=97.33%, 平均响应报文大小=9 kb
并发数：30, 耗时：396s
----------------------- 并发数：40 ------------------------
IP=112.194.89.251:4231(2022-04-21 12:34:04), 并发=40, 成功=182, 失败=18, 失败率=9%, 平均响应报文大小=314 kb
IP=112.194.89.251:4231(2022-04-21 12:34:04), 并发=40, 成功=181, 失败=19, 失败率=9.5%, 平均响应报文大小=312 kb
IP=112.194.89.251:4231(2022-04-21 12:34:04), 并发=40, 成功=181, 失败=19, 失败率=9.5%, 平均响应报文大小=312 kb
IP=112.194.89.251:4231(2022-04-21 12:34:04), 并发=40, 成功=190, 失败=10, 失败率=5%, 平均响应报文大小=328 kb
IP=112.194.89.251:4231(2022-04-21 12:34:04), 并发=40, 成功=170, 失败=30, 失败率=15%, 平均响应报文大小=293 kb
并发数：40, 耗时：226s
----------------------- 并发数：50 ------------------------
IP=117.26.131.160:4231(2022-04-21 12:37:50), 并发=50, 成功=235, 失败=15, 失败率=6%, 平均响应报文大小=324 kb
IP=117.26.131.160:4231(2022-04-21 12:37:50), 并发=50, 成功=223, 失败=27, 失败率=10.8%, 平均响应报文大小=308 kb
IP=117.26.131.160:4231(2022-04-21 12:37:50), 并发=50, 成功=231, 失败=19, 失败率=7.6%, 平均响应报文大小=319 kb
IP=117.26.131.160:4231(2022-04-21 12:37:50), 并发=50, 成功=232, 失败=18, 失败率=7.2%, 平均响应报文大小=320 kb
IP=117.26.131.160:4231(2022-04-21 12:37:50), 并发=50, 成功=229, 失败=21, 失败率=8.4%, 平均响应报文大小=316 kb
并发数：50, 耗时：246s
```



##### 第二批

```sql
----------------------- 并发数：10 ------------------------
IP=222.90.42.38:4231(2022-04-21 17:57:40), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=222.90.42.38:4231(2022-04-21 17:57:40), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=222.90.42.38:4231(2022-04-21 17:57:40), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=222.90.42.38:4231(2022-04-21 17:57:40), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=222.90.42.38:4231(2022-04-21 17:57:40), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：119s
----------------------- 并发数：20 ------------------------
IP=113.218.243.47:4231(2022-04-21 17:59:40), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
IP=113.218.243.47:4231(2022-04-21 17:59:40), 并发=20, 成功=196, 失败=4, 失败率=2%, 平均响应报文大小=338 kb
IP=113.218.243.47:4231(2022-04-21 17:59:40), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
IP=113.218.243.47:4231(2022-04-21 17:59:40), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=113.218.243.47:4231(2022-04-21 17:59:40), 并发=20, 成功=194, 失败=6, 失败率=3%, 平均响应报文大小=335 kb
并发数：20, 耗时：228s
----------------------- 并发数：30 ------------------------
IP=119.7.144.147:4258(2022-04-21 18:03:27), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
IP=119.7.144.147:4258(2022-04-21 18:03:27), 并发=30, 成功=297, 失败=3, 失败率=1%, 平均响应报文大小=342 kb
IP=119.7.144.147:4258(2022-04-21 18:03:27), 并发=30, 成功=293, 失败=7, 失败率=2.33%, 平均响应报文大小=337 kb
IP=119.7.144.147:4258(2022-04-21 18:03:27), 并发=30, 成功=289, 失败=11, 失败率=3.67%, 平均响应报文大小=332 kb
IP=119.7.144.147:4258(2022-04-21 18:03:27), 并发=30, 成功=296, 失败=4, 失败率=1.33%, 平均响应报文大小=341 kb
并发数：30, 耗时：301s
```

##### 第三批

```sql
----------------------- 并发数：10 ------------------------
IP=122.192.227.45:4278(2022-04-22 10:35:38), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=122.192.227.45:4278(2022-04-22 10:35:38), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=122.192.227.45:4278(2022-04-22 10:35:38), 并发=10, 成功=84, 失败=16, 失败率=16%, 平均响应报文大小=290 kb
IP=122.192.227.45:4278(2022-04-22 10:35:38), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=122.192.227.45:4278(2022-04-22 10:35:38), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：110s
----------------------- 并发数：20 ------------------------
IP=220.176.177.166:4223(2022-04-22 10:37:51), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.176.177.166:4223(2022-04-22 10:37:51), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.176.177.166:4223(2022-04-22 10:37:51), 并发=20, 成功=153, 失败=47, 失败率=23.5%, 平均响应报文大小=264 kb
IP=220.176.177.166:4223(2022-04-22 10:37:51), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.176.177.166:4223(2022-04-22 10:37:51), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：210s
----------------------- 并发数：30 ------------------------
IP=59.58.105.60:4206(2022-04-22 10:40:59), 并发=30, 成功=267, 失败=33, 失败率=11%, 平均响应报文大小=307 kb
IP=59.58.105.60:4206(2022-04-22 10:40:59), 并发=30, 成功=262, 失败=38, 失败率=12.67%, 平均响应报文大小=301 kb
IP=59.58.105.60:4206(2022-04-22 10:40:59), 并发=30, 成功=253, 失败=47, 失败率=15.67%, 平均响应报文大小=291 kb
IP=59.58.105.60:4206(2022-04-22 10:40:59), 并发=30, 成功=259, 失败=41, 失败率=13.67%, 平均响应报文大小=298 kb
IP=59.58.105.60:4206(2022-04-22 10:40:59), 并发=30, 成功=250, 失败=50, 失败率=16.67%, 平均响应报文大小=288 kb
并发数：30, 耗时：572s
----------------------- 并发数：40 ------------------------
IP=123.189.208.186:4224(2022-04-22 10:50:31), 并发=40, 成功=370, 失败=30, 失败率=7.5%, 平均响应报文大小=319 kb
IP=123.189.208.186:4224(2022-04-22 10:50:31), 并发=40, 成功=378, 失败=22, 失败率=5.5%, 平均响应报文大小=326 kb
IP=123.189.208.186:4224(2022-04-22 10:50:31), 并发=40, 成功=392, 失败=8, 失败率=2%, 平均响应报文大小=338 kb
IP=123.189.208.186:4224(2022-04-22 10:50:31), 并发=40, 成功=228, 失败=172, 失败率=43%, 平均响应报文大小=196 kb
IP=123.189.208.186:4224(2022-04-22 10:50:31), 并发=40, 成功=341, 失败=59, 失败率=14.75%, 平均响应报文大小=294 kb
并发数：40, 耗时：411s
```



#### 独享ip

##### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=115.209.76.216:4213(2022-04-21 13:20:48), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=115.209.76.216:4213(2022-04-21 13:20:48), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=346 kb
IP=115.209.76.216:4213(2022-04-21 13:20:48), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=115.209.76.216:4213(2022-04-21 13:20:48), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=115.209.76.216:4213(2022-04-21 13:20:48), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：53s
----------------------- 并发数：20 ------------------------
IP=124.230.9.19:4231(2022-04-21 13:21:37), 并发=20, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=124.230.9.19:4231(2022-04-21 13:21:37), 并发=20, 成功=96, 失败=4, 失败率=4%, 平均响应报文大小=331 kb
IP=124.230.9.19:4231(2022-04-21 13:21:37), 并发=20, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=124.230.9.19:4231(2022-04-21 13:21:37), 并发=20, 成功=99, 失败=1, 失败率=1%, 平均响应报文大小=342 kb
IP=124.230.9.19:4231(2022-04-21 13:21:37), 并发=20, 成功=99, 失败=1, 失败率=1%, 平均响应报文大小=342 kb
并发数：20, 耗时：106s
----------------------- 并发数：30 ------------------------
IP=58.46.248.15:4213(2022-04-21 13:23:24), 并发=30, 成功=145, 失败=5, 失败率=3.33%, 平均响应报文大小=334 kb
IP=58.46.248.15:4213(2022-04-21 13:23:24), 并发=30, 成功=146, 失败=4, 失败率=2.67%, 平均响应报文大小=336 kb
IP=58.46.248.15:4213(2022-04-21 13:23:24), 并发=30, 成功=150, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=58.46.248.15:4213(2022-04-21 13:23:24), 并发=30, 成功=150, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=58.46.248.15:4213(2022-04-21 13:23:24), 并发=30, 成功=148, 失败=2, 失败率=1.33%, 平均响应报文大小=341 kb
并发数：30, 耗时：161s
----------------------- 并发数：40 ------------------------
IP=183.7.120.7:4231(2022-04-21 13:26:06), 并发=40, 成功=126, 失败=74, 失败率=37%, 平均响应报文大小=217 kb
IP=183.7.120.7:4231(2022-04-21 13:26:06), 并发=40, 成功=181, 失败=19, 失败率=9.5%, 平均响应报文大小=312 kb
IP=183.7.120.7:4231(2022-04-21 13:26:06), 并发=40, 成功=174, 失败=26, 失败率=13%, 平均响应报文大小=300 kb
IP=183.7.120.7:4231(2022-04-21 13:26:06), 并发=40, 成功=182, 失败=18, 失败率=9%, 平均响应报文大小=314 kb
IP=183.7.120.7:4231(2022-04-21 13:26:06), 并发=40, 成功=165, 失败=35, 失败率=17.5%, 平均响应报文大小=285 kb
并发数：40, 耗时：250s
----------------------- 并发数：50 ------------------------
IP=123.180.213.42:4231(2022-04-21 13:30:16), 并发=50, 成功=227, 失败=23, 失败率=9.2%, 平均响应报文大小=313 kb
IP=123.180.213.42:4231(2022-04-21 13:30:16), 并发=50, 成功=246, 失败=4, 失败率=1.6%, 平均响应报文大小=340 kb
IP=123.180.213.42:4231(2022-04-21 13:30:16), 并发=50, 成功=238, 失败=12, 失败率=4.8%, 平均响应报文大小=329 kb
IP=123.180.213.42:4231(2022-04-21 13:30:16), 并发=50, 成功=243, 失败=7, 失败率=2.8%, 平均响应报文大小=336 kb
IP=123.180.213.42:4231(2022-04-21 13:30:16), 并发=50, 成功=240, 失败=10, 失败率=4%, 平均响应报文大小=331 kb
并发数：50, 耗时：229s
```

##### 第二批

```sql
----------------------- 并发数：10 ------------------------
IP=60.20.207.32:4220(2022-04-21 18:03:26), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=60.20.207.32:4220(2022-04-21 18:03:26), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=60.20.207.32:4220(2022-04-21 18:03:26), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=60.20.207.32:4220(2022-04-21 18:03:26), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=60.20.207.32:4220(2022-04-21 18:03:26), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：196s
----------------------- 并发数：20 ------------------------
IP=183.165.244.229:4231(2022-04-21 17:57:12), 并发=20, 成功=197, 失败=3, 失败率=1.5%, 平均响应报文大小=340 kb
IP=183.165.244.229:4231(2022-04-21 17:57:12), 并发=20, 成功=195, 失败=5, 失败率=2.5%, 平均响应报文大小=336 kb
IP=183.165.244.229:4231(2022-04-21 17:57:12), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
IP=183.165.244.229:4231(2022-04-21 17:57:12), 并发=20, 成功=198, 失败=2, 失败率=1%, 平均响应报文大小=342 kb
IP=183.165.244.229:4231(2022-04-21 17:57:12), 并发=20, 成功=197, 失败=3, 失败率=1.5%, 平均响应报文大小=340 kb
并发数：20, 耗时：227s
----------------------- 并发数：30 ------------------------
IP=119.7.144.230:4231(2022-04-21 18:11:00), 并发=30, 成功=299, 失败=1, 失败率=0.33%, 平均响应报文大小=344 kb
IP=119.7.144.230:4231(2022-04-21 18:11:00), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
IP=119.7.144.230:4231(2022-04-21 18:11:00), 并发=30, 成功=295, 失败=5, 失败率=1.67%, 平均响应报文大小=339 kb
IP=119.7.144.230:4231(2022-04-21 18:11:00), 并发=30, 成功=280, 失败=20, 失败率=6.67%, 平均响应报文大小=322 kb
IP=119.7.144.230:4231(2022-04-21 18:11:00), 并发=30, 成功=294, 失败=6, 失败率=2%, 平均响应报文大小=338 kb
并发数：30, 耗时：293s
----------------------- 并发数：40 ------------------------
IP=112.132.235.247:4231(2022-04-21 18:06:01), 并发=40, 成功=365, 失败=35, 失败率=8.75%, 平均响应报文大小=315 kb
IP=112.132.235.247:4231(2022-04-21 18:06:01), 并发=40, 成功=390, 失败=10, 失败率=2.5%, 平均响应报文大小=336 kb
IP=112.132.235.247:4231(2022-04-21 18:06:01), 并发=40, 成功=399, 失败=1, 失败率=0.25%, 平均响应报文大小=344 kb
IP=112.132.235.247:4231(2022-04-21 18:06:01), 并发=40, 成功=389, 失败=11, 失败率=2.75%, 平均响应报文大小=336 kb
IP=112.132.235.247:4231(2022-04-21 18:06:01), 并发=40, 成功=390, 失败=10, 失败率=2.5%, 平均响应报文大小=336 kb
并发数：40, 耗时：384s
```

##### 第三批

```sql
----------------------- 并发数：10 ------------------------
IP=182.111.83.212:4231(2022-04-22 10:36:06), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.111.83.212:4231(2022-04-22 10:36:06), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.111.83.212:4231(2022-04-22 10:36:06), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.111.83.212:4231(2022-04-22 10:36:06), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.111.83.212:4231(2022-04-22 10:36:06), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：207s
----------------------- 并发数：20 ------------------------
IP=220.179.219.65:4278(2022-04-22 10:39:34), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.179.219.65:4278(2022-04-22 10:39:34), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.179.219.65:4278(2022-04-22 10:39:34), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.179.219.65:4278(2022-04-22 10:39:34), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=220.179.219.65:4278(2022-04-22 10:39:34), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
并发数：20, 耗时：212s
----------------------- 并发数：30 ------------------------
IP=27.191.67.5:4241(2022-04-22 10:43:06), 并发=30, 成功=299, 失败=1, 失败率=0.33%, 平均响应报文大小=344 kb
IP=27.191.67.5:4241(2022-04-22 10:43:06), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
IP=27.191.67.5:4241(2022-04-22 10:43:06), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
IP=27.191.67.5:4241(2022-04-22 10:43:06), 并发=30, 成功=296, 失败=4, 失败率=1.33%, 平均响应报文大小=341 kb
IP=27.191.67.5:4241(2022-04-22 10:43:06), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
并发数：30, 耗时：145s
----------------------- 并发数：40 ------------------------
IP=175.149.62.140:4278(2022-04-22 10:45:32), 并发=40, 成功=386, 失败=14, 失败率=3.5%, 平均响应报文大小=333 kb
IP=175.149.62.140:4278(2022-04-22 10:45:32), 并发=40, 成功=385, 失败=15, 失败率=3.75%, 平均响应报文大小=332 kb
IP=175.149.62.140:4278(2022-04-22 10:45:32), 并发=40, 成功=377, 失败=23, 失败率=5.75%, 平均响应报文大小=325 kb
IP=175.149.62.140:4278(2022-04-22 10:45:32), 并发=40, 成功=65, 失败=335, 失败率=83.75%, 平均响应报文大小=56 kb
IP=175.149.62.140:4278(2022-04-22 10:45:32), 并发=40, 成功=76, 失败=324, 失败率=81%, 平均响应报文大小=65 kb
并发数：40, 耗时：316s
----------------------- 并发数：50 ------------------------
IP=114.103.89.114:4210(2022-04-22 10:50:48), 并发=50, 成功=492, 失败=8, 失败率=1.6%, 平均响应报文大小=340 kb
IP=114.103.89.114:4210(2022-04-22 10:50:48), 并发=50, 成功=489, 失败=11, 失败率=2.2%, 平均响应报文大小=337 kb
IP=114.103.89.114:4210(2022-04-22 10:50:48), 并发=50, 成功=491, 失败=9, 失败率=1.8%, 平均响应报文大小=339 kb
IP=114.103.89.114:4210(2022-04-22 10:50:48), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.103.89.114:4210(2022-04-22 10:50:48), 并发=50, 成功=487, 失败=13, 失败率=2.6%, 平均响应报文大小=336 kb
并发数：50, 耗时：476s
```



#### 隧道ip

##### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=30, 失败=70, 失败率=70%, 平均响应报文大小=103 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=97, 失败=3, 失败率=3%, 平均响应报文大小=335 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=99, 失败=1, 失败率=1%, 平均响应报文大小=342 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=69, 失败=31, 失败率=31%, 平均响应报文大小=238 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=70, 失败=30, 失败率=30%, 平均响应报文大小=242 kb
并发数：10, 耗时：354s
----------------------- 并发数：20 ------------------------
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=198, 失败=2, 失败率=1%, 平均响应报文大小=342 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=195, 失败=5, 失败率=2.5%, 平均响应报文大小=337 kb
并发数：20, 耗时：206s
----------------------- 并发数：30 ------------------------
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=49, 失败=251, 失败率=83.67%, 平均响应报文大小=56 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=9, 失败=291, 失败率=97%, 平均响应报文大小=10 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
并发数：30, 耗时：160s
```

##### 第二批

```sql
----------------------- 并发数：10 ------------------------
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=30, 失败=70, 失败率=70%, 平均响应报文大小=103 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=97, 失败=3, 失败率=3%, 平均响应报文大小=335 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=99, 失败=1, 失败率=1%, 平均响应报文大小=342 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=69, 失败=31, 失败率=31%, 平均响应报文大小=238 kb
IP=42.6.114.104:5404(2022-04-21 17:24:26), 并发=10, 成功=70, 失败=30, 失败率=30%, 平均响应报文大小=242 kb
并发数：10, 耗时：354s
----------------------- 并发数：20 ------------------------
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=198, 失败=2, 失败率=1%, 平均响应报文大小=342 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:5735(2022-04-21 17:30:27), 并发=20, 成功=195, 失败=5, 失败率=2.5%, 平均响应报文大小=337 kb
并发数：20, 耗时：206s
----------------------- 并发数：30 ------------------------
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=49, 失败=251, 失败率=83.67%, 平均响应报文大小=56 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=9, 失败=291, 失败率=97%, 平均响应报文大小=10 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
IP=42.6.114.99:7566(2022-04-21 17:48:30), 并发=30, 成功=10, 失败=290, 失败率=96.67%, 平均响应报文大小=11 kb
并发数：30, 耗时：160s
----------------------- 并发数：40 ------------------------
IP=42.6.114.103:9643(2022-04-21 17:46:24), 并发=40, 成功=58, 失败=342, 失败率=85.5%, 平均响应报文大小=50 kb
IP=42.6.114.103:9643(2022-04-21 17:46:24), 并发=40, 成功=30, 失败=370, 失败率=92.5%, 平均响应报文大小=25 kb
IP=42.6.114.103:9643(2022-04-21 17:46:24), 并发=40, 成功=10, 失败=390, 失败率=97.5%, 平均响应报文大小=8 kb
IP=42.6.114.103:9643(2022-04-21 17:46:24), 并发=40, 成功=10, 失败=390, 失败率=97.5%, 平均响应报文大小=8 kb
IP=42.6.114.103:9643(2022-04-21 17:46:24), 并发=40, 成功=20, 失败=380, 失败率=95%, 平均响应报文大小=17 kb
并发数：40, 耗时：164s
----------------------- 并发数：50 ------------------------
IP=42.6.114.104:8816(2022-04-21 17:50:42), 并发=50, 成功=11, 失败=489, 失败率=97.8%, 平均响应报文大小=7 kb
IP=42.6.114.104:8816(2022-04-21 17:50:42), 并发=50, 成功=9, 失败=491, 失败率=98.2%, 平均响应报文大小=6 kb
IP=42.6.114.104:8816(2022-04-21 17:50:42), 并发=50, 成功=10, 失败=490, 失败率=98%, 平均响应报文大小=6 kb
IP=42.6.114.104:8816(2022-04-21 17:50:42), 并发=50, 成功=10, 失败=490, 失败率=98%, 平均响应报文大小=6 kb
IP=42.6.114.104:8816(2022-04-21 17:50:42), 并发=50, 成功=11, 失败=489, 失败率=97.8%, 平均响应报文大小=7 kb
并发数：50, 耗时：68s
```

##### 第三批

```sql
----------------------- 并发数：10 ------------------------
IP=42.6.114.120:5669(2022-04-21 17:55:28), 并发=10, 成功=97, 失败=3, 失败率=3%, 平均响应报文大小=335 kb
IP=42.6.114.120:5669(2022-04-21 17:55:28), 并发=10, 成功=98, 失败=2, 失败率=2%, 平均响应报文大小=338 kb
IP=42.6.114.120:5669(2022-04-21 17:55:28), 并发=10, 成功=91, 失败=9, 失败率=9%, 平均响应报文大小=314 kb
IP=42.6.114.120:5669(2022-04-21 17:55:28), 并发=10, 成功=96, 失败=4, 失败率=4%, 平均响应报文大小=331 kb
IP=42.6.114.120:5669(2022-04-21 17:55:28), 并发=10, 成功=98, 失败=2, 失败率=2%, 平均响应报文大小=338 kb
并发数：10, 耗时：257s
----------------------- 并发数：20 ------------------------
IP=42.6.114.121:8385(2022-04-21 18:12:06), 并发=20, 成功=20, 失败=180, 失败率=90%, 平均响应报文大小=34 kb
IP=42.6.114.121:8385(2022-04-21 18:12:06), 并发=20, 成功=22, 失败=178, 失败率=89%, 平均响应报文大小=38 kb
IP=42.6.114.121:8385(2022-04-21 18:12:06), 并发=20, 成功=18, 失败=182, 失败率=91%, 平均响应报文大小=31 kb
IP=42.6.114.121:8385(2022-04-21 18:12:06), 并发=20, 成功=20, 失败=180, 失败率=90%, 平均响应报文大小=34 kb
IP=42.6.114.121:8385(2022-04-21 18:12:06), 并发=20, 成功=10, 失败=190, 失败率=95%, 平均响应报文大小=17 kb
并发数：20, 耗时：106s
----------------------- 并发数：30 ------------------------
IP=42.6.114.120:7558(2022-04-21 17:59:31), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:7558(2022-04-21 17:59:31), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:7558(2022-04-21 17:59:31), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:7558(2022-04-21 17:59:31), 并发=30, 成功=297, 失败=3, 失败率=1%, 平均响应报文大小=342 kb
IP=42.6.114.120:7558(2022-04-21 17:59:31), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：30, 耗时：296s
----------------------- 并发数：40 ------------------------
IP=42.6.114.120:2285(2022-04-21 18:13:22), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:2285(2022-04-21 18:13:22), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:2285(2022-04-21 18:13:22), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:2285(2022-04-21 18:13:22), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.6.114.120:2285(2022-04-21 18:13:22), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：82s
----------------------- 并发数：50 ------------------------
IP=42.6.114.103:8509(2022-04-21 18:11:02), 并发=50, 成功=20, 失败=480, 失败率=96%, 平均响应报文大小=13 kb
IP=42.6.114.103:8509(2022-04-21 18:11:02), 并发=50, 成功=29, 失败=471, 失败率=94.2%, 平均响应报文大小=20 kb
IP=42.6.114.103:8509(2022-04-21 18:11:02), 并发=50, 成功=9, 失败=491, 失败率=98.2%, 平均响应报文大小=6 kb
IP=42.6.114.103:8509(2022-04-21 18:11:02), 并发=50, 成功=18, 失败=482, 失败率=96.4%, 平均响应报文大小=12 kb
IP=42.6.114.103:8509(2022-04-21 18:11:02), 并发=50, 成功=14, 失败=486, 失败率=97.2%, 平均响应报文大小=9 kb
并发数：50, 耗时：114s
```



## 代理云

#### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=182.96.47.138:57114(2022-04-21 13:09:26), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.96.47.138:57114(2022-04-21 13:09:26), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.96.47.138:57114(2022-04-21 13:09:26), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=182.96.47.138:57114(2022-04-21 13:09:26), 并发=10, 成功=49, 失败=1, 失败率=2%, 平均响应报文大小=338 kb
IP=182.96.47.138:57114(2022-04-21 13:09:26), 并发=10, 成功=50, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：38s
----------------------- 并发数：20 ------------------------
IP=113.229.60.153:57114(2022-04-21 13:12:50), 并发=20, 成功=86, 失败=14, 失败率=14%, 平均响应报文大小=297 kb
IP=113.229.60.153:57114(2022-04-21 13:12:50), 并发=20, 成功=84, 失败=16, 失败率=16%, 平均响应报文大小=290 kb
IP=113.229.60.153:57114(2022-04-21 13:12:50), 并发=20, 成功=93, 失败=7, 失败率=7%, 平均响应报文大小=321 kb
IP=113.229.60.153:57114(2022-04-21 13:12:50), 并发=20, 成功=92, 失败=8, 失败率=8%, 平均响应报文大小=317 kb
IP=113.229.60.153:57114(2022-04-21 13:12:50), 并发=20, 成功=97, 失败=3, 失败率=3%, 平均响应报文大小=335 kb
并发数：20, 耗时：196s
----------------------- 并发数：30 ------------------------
IP=110.86.183.26:57114(2022-04-21 13:16:05), 并发=30, 成功=125, 失败=25, 失败率=16.67%, 平均响应报文大小=288 kb
IP=110.86.183.26:57114(2022-04-21 13:16:05), 并发=30, 成功=118, 失败=32, 失败率=21.33%, 平均响应报文大小=271 kb
IP=110.86.183.26:57114(2022-04-21 13:16:05), 并发=30, 成功=110, 失败=40, 失败率=26.67%, 平均响应报文大小=253 kb
IP=110.86.183.26:57114(2022-04-21 13:16:05), 并发=30, 成功=114, 失败=36, 失败率=24%, 平均响应报文大小=262 kb
IP=110.86.183.26:57114(2022-04-21 13:16:05), 并发=30, 成功=114, 失败=36, 失败率=24%, 平均响应报文大小=262 kb
并发数：30, 耗时：177s
----------------------- 并发数：40 ------------------------
IP=121.205.230.170:57114(2022-04-21 13:18:32), 并发=40, 成功=194, 失败=6, 失败率=3%, 平均响应报文大小=335 kb
IP=121.205.230.170:57114(2022-04-21 13:18:32), 并发=40, 成功=98, 失败=102, 失败率=51%, 平均响应报文大小=169 kb
IP=121.205.230.170:57114(2022-04-21 13:18:32), 并发=40, 成功=194, 失败=6, 失败率=3%, 平均响应报文大小=335 kb
IP=121.205.230.170:57114(2022-04-21 13:18:32), 并发=40, 成功=100, 失败=100, 失败率=50%, 平均响应报文大小=172 kb
IP=121.205.230.170:57114(2022-04-21 13:18:32), 并发=40, 成功=0, 失败=200, 失败率=100%, 平均响应报文大小=0 kb
并发数：40, 耗时：59s
```



#### 第二批

```sql
----------------------- 并发数：10 ------------------------
ip 49.87.194.101:57114(2022-04-21 17:11:12) 有效期小于1分钟，重新拉取
ip 49.87.194.101:57114(2022-04-21 17:11:12) 有效期小于1分钟，重新拉取
IP=49.87.194.101:57114(2022-04-21 17:11:12), 并发=10, 成功=88, 失败=12, 失败率=12%, 平均响应报文大小=304 kb
IP=49.87.194.101:57114(2022-04-21 17:11:12), 并发=10, 成功=92, 失败=8, 失败率=8%, 平均响应报文大小=317 kb
IP=49.87.194.101:57114(2022-04-21 17:11:12), 并发=10, 成功=28, 失败=72, 失败率=72%, 平均响应报文大小=96 kb
并发数：10, 耗时：384s
----------------------- 并发数：20 ------------------------
IP=42.57.203.49:57114(2022-04-21 17:15:59), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.57.203.49:57114(2022-04-21 17:15:59), 并发=20, 成功=198, 失败=2, 失败率=1%, 平均响应报文大小=342 kb
IP=42.57.203.49:57114(2022-04-21 17:15:59), 并发=20, 成功=70, 失败=130, 失败率=65%, 平均响应报文大小=120 kb
IP=42.57.203.49:57114(2022-04-21 17:15:59), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=42.57.203.49:57114(2022-04-21 17:15:59), 并发=20, 成功=179, 失败=21, 失败率=10.5%, 平均响应报文大小=309 kb
并发数：20, 耗时：114s
----------------------- 并发数：30 ------------------------
ip 121.232.148.193:57114(2022-04-21 17:18:00) 有效期小于1分钟，重新拉取
ip 121.232.148.193:57114(2022-04-21 17:18:00) 有效期小于1分钟，重新拉取
ip 121.232.148.193:57114(2022-04-21 17:18:00) 有效期小于1分钟，重新拉取
IP=121.232.148.193:57114(2022-04-21 17:18:00), 并发=30, 成功=198, 失败=102, 失败率=34%, 平均响应报文大小=228 kb
IP=121.232.148.193:57114(2022-04-21 17:18:00), 并发=30, 成功=181, 失败=119, 失败率=39.67%, 平均响应报文大小=208 kb
并发数：30, 耗时：193s
----------------------- 并发数：40 ------------------------
IP=60.185.150.202:57114(2022-04-21 17:20:20), 并发=40, 成功=257, 失败=143, 失败率=35.75%, 平均响应报文大小=222 kb
IP=60.185.150.202:57114(2022-04-21 17:20:20), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
IP=60.185.150.202:57114(2022-04-21 17:20:20), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
IP=60.185.150.202:57114(2022-04-21 17:20:20), 并发=40, 成功=5, 失败=395, 失败率=98.75%, 平均响应报文大小=4 kb
IP=60.185.150.202:57114(2022-04-21 17:20:20), 并发=40, 成功=239, 失败=161, 失败率=40.25%, 平均响应报文大小=206 kb
并发数：40, 耗时：52s
```



## 亿牛云

#### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=183.136.232.139:32181(2023-01-01 01:01:01), 并发=10, 成功=55, 失败=45, 失败率=45%, 平均响应报文大小=190 kb
IP=183.136.232.139:32181(2023-01-01 01:01:01), 并发=10, 成功=47, 失败=53, 失败率=53%, 平均响应报文大小=162 kb
IP=183.136.232.139:32181(2023-01-01 01:01:01), 并发=10, 成功=53, 失败=47, 失败率=47%, 平均响应报文大小=183 kb
IP=183.136.232.139:32181(2023-01-01 01:01:01), 并发=10, 成功=50, 失败=50, 失败率=50%, 平均响应报文大小=172 kb
IP=183.136.232.139:32181(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
并发数：10, 耗时：170s
----------------------- 并发数：20 ------------------------
IP=114.231.46.237:28033(2023-01-01 01:01:01), 并发=20, 成功=90, 失败=110, 失败率=55%, 平均响应报文大小=155 kb
IP=114.231.46.237:28033(2023-01-01 01:01:01), 并发=20, 成功=98, 失败=102, 失败率=51%, 平均响应报文大小=169 kb
IP=114.231.46.237:28033(2023-01-01 01:01:01), 并发=20, 成功=84, 失败=116, 失败率=58%, 平均响应报文大小=145 kb
IP=114.231.46.237:28033(2023-01-01 01:01:01), 并发=20, 成功=94, 失败=106, 失败率=53%, 平均响应报文大小=162 kb
IP=114.231.46.237:28033(2023-01-01 01:01:01), 并发=20, 成功=93, 失败=107, 失败率=53.5%, 平均响应报文大小=160 kb
并发数：20, 耗时：173s
----------------------- 并发数：30 ------------------------
IP=114.230.107.180:21651(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.230.107.180:21651(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.230.107.180:21651(2023-01-01 01:01:01), 并发=30, 成功=295, 失败=5, 失败率=1.67%, 平均响应报文大小=339 kb
IP=114.230.107.180:21651(2023-01-01 01:01:01), 并发=30, 成功=296, 失败=4, 失败率=1.33%, 平均响应报文大小=340 kb
IP=114.230.107.180:21651(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：30, 耗时：227s
----------------------- 并发数：40 ------------------------
IP=222.189.19.2:34116(2023-01-01 01:01:01), 并发=40, 成功=15, 失败=385, 失败率=96.25%, 平均响应报文大小=12 kb
IP=222.189.19.2:34116(2023-01-01 01:01:01), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
IP=222.189.19.2:34116(2023-01-01 01:01:01), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
IP=222.189.19.2:34116(2023-01-01 01:01:01), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
IP=222.189.19.2:34116(2023-01-01 01:01:01), 并发=40, 成功=0, 失败=400, 失败率=100%, 平均响应报文大小=0 kb
并发数：40, 耗时：255s
----------------------- 并发数：50 ------------------------
IP=122.5.0.66:31365(2023-01-01 01:01:01), 并发=50, 成功=8, 失败=492, 失败率=98.4%, 平均响应报文大小=5 kb
IP=122.5.0.66:31365(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
IP=122.5.0.66:31365(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
IP=122.5.0.66:31365(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
IP=122.5.0.66:31365(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
并发数：50, 耗时：256s
```



#### 第二批

```sql
----------------------- 并发数：10 ------------------------
IP=117.86.14.65:24422(2023-01-01 01:01:01), 并发=10, 成功=60, 失败=40, 失败率=40%, 平均响应报文大小=207 kb
IP=117.86.14.65:24422(2023-01-01 01:01:01), 并发=10, 成功=71, 失败=29, 失败率=29%, 平均响应报文大小=245 kb
IP=117.86.14.65:24422(2023-01-01 01:01:01), 并发=10, 成功=65, 失败=35, 失败率=35%, 平均响应报文大小=224 kb
IP=117.86.14.65:24422(2023-01-01 01:01:01), 并发=10, 成功=70, 失败=30, 失败率=30%, 平均响应报文大小=242 kb
IP=117.86.14.65:24422(2023-01-01 01:01:01), 并发=10, 成功=60, 失败=40, 失败率=40%, 平均响应报文大小=207 kb
并发数：10, 耗时：119s
----------------------- 并发数：20 ------------------------
IP=182.47.88.173:24407(2023-01-01 01:01:01), 并发=20, 成功=164, 失败=36, 失败率=18%, 平均响应报文大小=283 kb
IP=182.47.88.173:24407(2023-01-01 01:01:01), 并发=20, 成功=190, 失败=10, 失败率=5%, 平均响应报文大小=328 kb
IP=182.47.88.173:24407(2023-01-01 01:01:01), 并发=20, 成功=191, 失败=9, 失败率=4.5%, 平均响应报文大小=330 kb
IP=182.47.88.173:24407(2023-01-01 01:01:01), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
IP=182.47.88.173:24407(2023-01-01 01:01:01), 并发=20, 成功=174, 失败=26, 失败率=13%, 平均响应报文大小=300 kb
并发数：20, 耗时：549s
----------------------- 并发数：30 ------------------------
IP=218.93.205.6:38268(2023-01-01 01:01:01), 并发=30, 成功=14, 失败=286, 失败率=95.33%, 平均响应报文大小=16 kb
IP=218.93.205.6:38268(2023-01-01 01:01:01), 并发=30, 成功=15, 失败=285, 失败率=95%, 平均响应报文大小=17 kb
IP=218.93.205.6:38268(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
IP=218.93.205.6:38268(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
IP=218.93.205.6:38268(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
并发数：30, 耗时：275s
```



#### 第三批

```sql
----------------------- 并发数：10 ------------------------
IP=114.231.42.73:22252(2023-01-01 01:01:01), 并发=10, 成功=75, 失败=25, 失败率=25%, 平均响应报文大小=259 kb
IP=114.231.42.73:22252(2023-01-01 01:01:01), 并发=10, 成功=63, 失败=37, 失败率=37%, 平均响应报文大小=217 kb
IP=114.231.42.73:22252(2023-01-01 01:01:01), 并发=10, 成功=70, 失败=30, 失败率=30%, 平均响应报文大小=241 kb
IP=114.231.42.73:22252(2023-01-01 01:01:01), 并发=10, 成功=60, 失败=40, 失败率=40%, 平均响应报文大小=207 kb
IP=114.231.42.73:22252(2023-01-01 01:01:01), 并发=10, 成功=69, 失败=31, 失败率=31%, 平均响应报文大小=238 kb
并发数：10, 耗时：139s
----------------------- 并发数：20 ------------------------
IP=114.237.54.113:22195(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.237.54.113:22195(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.237.54.113:22195(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.237.54.113:22195(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.237.54.113:22195(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：71s
----------------------- 并发数：30 ------------------------
IP=114.231.15.191:33108(2023-01-01 01:01:01), 并发=30, 成功=15, 失败=285, 失败率=95%, 平均响应报文大小=17 kb
IP=114.231.15.191:33108(2023-01-01 01:01:01), 并发=30, 成功=15, 失败=285, 失败率=95%, 平均响应报文大小=17 kb
IP=114.231.15.191:33108(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
IP=114.231.15.191:33108(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
IP=114.231.15.191:33108(2023-01-01 01:01:01), 并发=30, 成功=0, 失败=300, 失败率=100%, 平均响应报文大小=0 kb
并发数：30, 耗时：267s
```



## 游杰

#### 第一批

```sql
----------------------- 并发数：10 ------------------------
IP=49.81.197.138:26964(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
IP=49.81.197.138:26964(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
IP=49.81.197.138:26964(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
IP=49.81.197.138:26964(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
IP=49.81.197.138:26964(2023-01-01 01:01:01), 并发=10, 成功=0, 失败=100, 失败率=100%, 平均响应报文大小=0 kb
并发数：10, 耗时：510s
----------------------- 并发数：20 ------------------------
IP=49.68.227.196:25315(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.227.196:25315(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.227.196:25315(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.227.196:25315(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.227.196:25315(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：72s
----------------------- 并发数：30 ------------------------
IP=49.68.60.108:29818(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.108:29818(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.108:29818(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.108:29818(2023-01-01 01:01:01), 并发=30, 成功=299, 失败=1, 失败率=0.33%, 平均响应报文大小=344 kb
IP=49.68.60.108:29818(2023-01-01 01:01:01), 并发=30, 成功=30, 失败=270, 失败率=90%, 平均响应报文大小=34 kb
并发数：30, 耗时：154s
----------------------- 并发数：40 ------------------------
IP=117.95.176.218:25206(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.176.218:25206(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.176.218:25206(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.176.218:25206(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.176.218:25206(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：85s
----------------------- 并发数：50 ------------------------
IP=117.87.239.58:22818(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.87.239.58:22818(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.87.239.58:22818(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=117.87.239.58:22818(2023-01-01 01:01:01), 并发=50, 成功=498, 失败=2, 失败率=0.4%, 平均响应报文大小=344 kb
IP=117.87.239.58:22818(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
并发数：50, 耗时：120s
```

#### 第二批

```sql
----------------------- 并发数：10 ------------------------
IP=49.68.225.120:23019(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.225.120:23019(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.225.120:23019(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.225.120:23019(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.225.120:23019(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：67s
----------------------- 并发数：20 ------------------------
IP=180.104.8.253:23166(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.8.253:23166(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.8.253:23166(2023-01-01 01:01:01), 并发=20, 成功=199, 失败=1, 失败率=0.5%, 平均响应报文大小=343 kb
IP=180.104.8.253:23166(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.8.253:23166(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：68s
----------------------- 并发数：30 ------------------------
IP=114.234.36.88:25313(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.234.36.88:25313(2023-01-01 01:01:01), 并发=30, 成功=298, 失败=2, 失败率=0.67%, 平均响应报文大小=343 kb
IP=114.234.36.88:25313(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.234.36.88:25313(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.234.36.88:25313(2023-01-01 01:01:01), 并发=30, 成功=299, 失败=1, 失败率=0.33%, 平均响应报文大小=344 kb
并发数：30, 耗时：71s
----------------------- 并发数：40 ------------------------
IP=49.68.60.132:21675(2023-01-01 01:01:01), 并发=40, 成功=399, 失败=1, 失败率=0.25%, 平均响应报文大小=344 kb
IP=49.68.60.132:21675(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.132:21675(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.132:21675(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.68.60.132:21675(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：96s
----------------------- 并发数：50 ------------------------
IP=117.87.131.93:29579(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=117.87.131.93:29579(2023-01-01 01:01:01), 并发=50, 成功=493, 失败=7, 失败率=1.4%, 平均响应报文大小=340 kb
IP=117.87.131.93:29579(2023-01-01 01:01:01), 并发=50, 成功=99, 失败=401, 失败率=80.2%, 平均响应报文大小=68 kb
IP=117.87.131.93:29579(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
IP=117.87.131.93:29579(2023-01-01 01:01:01), 并发=50, 成功=0, 失败=500, 失败率=100%, 平均响应报文大小=0 kb
并发数：50, 耗时：140s
```



#### 第三批

```sql
----------------------- 并发数：10 ------------------------
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：59s
----------------------- 并发数：20 ------------------------
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：68s
----------------------- 并发数：30 ------------------------
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：30, 耗时：87s
----------------------- 并发数：40 ------------------------
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=398, 失败=2, 失败率=0.5%, 平均响应报文大小=343 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：84s
----------------------- 并发数：50 ------------------------
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=498, 失败=2, 失败率=0.4%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：50, 耗时：104s
```



#### 第四批

```sql
----------------------- 并发数：10 ------------------------
IP=49.70.13.228:29715(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.228:29715(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.228:29715(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.228:29715(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.228:29715(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：58s
----------------------- 并发数：20 ------------------------
IP=117.95.174.53:20194(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.174.53:20194(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.174.53:20194(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.174.53:20194(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=117.95.174.53:20194(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：61s
----------------------- 并发数：30 ------------------------
IP=114.239.106.179:25027(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.239.106.179:25027(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.239.106.179:25027(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.239.106.179:25027(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=114.239.106.179:25027(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：30, 耗时：62s
----------------------- 并发数：40 ------------------------
IP=49.89.80.255:23217(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.255:23217(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.255:23217(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.255:23217(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.255:23217(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：93s
----------------------- 并发数：50 ------------------------
IP=49.89.226.113:22457(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.226.113:22457(2023-01-01 01:01:01), 并发=50, 成功=498, 失败=2, 失败率=0.4%, 平均响应报文大小=344 kb
IP=49.89.226.113:22457(2023-01-01 01:01:01), 并发=50, 成功=496, 失败=4, 失败率=0.8%, 平均响应报文大小=342 kb
IP=49.89.226.113:22457(2023-01-01 01:01:01), 并发=50, 成功=495, 失败=5, 失败率=1%, 平均响应报文大小=342 kb
IP=49.89.226.113:22457(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：50, 耗时：110s
```



#### 第五批

```sql
----------------------- 并发数：10 ------------------------
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.103.191:28888(2023-01-01 01:01:01), 并发=10, 成功=100, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：10, 耗时：59s
----------------------- 并发数：20 ------------------------
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.70.13.37:25238(2023-01-01 01:01:01), 并发=20, 成功=200, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：20, 耗时：68s
----------------------- 并发数：30 ------------------------
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=49.89.80.191:29777(2023-01-01 01:01:01), 并发=30, 成功=300, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：30, 耗时：87s
----------------------- 并发数：40 ------------------------
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=398, 失败=2, 失败率=0.5%, 平均响应报文大小=343 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
IP=180.104.9.226:28188(2023-01-01 01:01:01), 并发=40, 成功=400, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：40, 耗时：84s
----------------------- 并发数：50 ------------------------
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=499, 失败=1, 失败率=0.2%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=498, 失败=2, 失败率=0.4%, 平均响应报文大小=344 kb
IP=114.239.71.114:26559(2023-01-01 01:01:01), 并发=50, 成功=500, 失败=0, 失败率=0%, 平均响应报文大小=345 kb
并发数：50, 耗时：104s
```



## IP价格计算

```
代理云一天14万个IP，21000一个月
14*10000*price=21000,price=0.15元/ip

芝麻两个套餐一个13W个IP一天，一个3WIP一天，一年32万，但是目前芝麻存在问题，IP会重复计费，一直没去修复BUG，一天ADX只用到一半的量
32*10000=price*16*10000*365, price=0.00547元/ip

亿牛云：10并发 10新建（按照100毫秒间隔。IP白名单默认3个。5分钟有效时间。报价：每天至少1万IP消费；1万IP=100元
100=price*10000,price=0.01元/ip

游杰：每天10W IP，每月2.2W
每天11W IP，每月2.2W
10*10000*price*30=2.2*10000, price=0.0073元/ip
```





# 备忘录

统计上（请求）下（响应）行的数据大小。

ip池的每个ip提前检查，还有1分钟过期就判定为失效。

实测芝麻代理1个IP，20并发，带宽6MB左右

所以真实定制规则取一半，1个ip，10个并发，3MB的带宽限制。优量广告那边：20w请求/小时\*每次请求40kb

一个ip单位时间内，不能重复请求多少次

所以6个ip就行。

限流风控，超过100个并发/秒，就限流。50 -> 5ip 100->10ip

在前面限流的前提下，然后再做ip的质量筛选。筛选的标准，是单位时间内，失败的百分比不能超过5%；



3千万请求一天 1kb以下 EDX 销量更新



优量：每小时20W个请求，每秒60个请求，每个请求20KB。算做每秒100个请求，40KB，所以每秒4000KB。ip为每秒30并发请求，每条数据350KB，算出1个ip就足够。算做2个ip。

100并发/秒 -> 2个ip，每秒10MB带宽

500并发/秒 -> 10个IP，每秒20MB带宽



edx-sale：每小时30w个请求，每秒83个请求，每个请求4KB。



cpu disk 11点半到12点 出现尖刺，看看什么情况



监控每天拉取ip的数量

后续要查看带宽使用量，以及内存使用量，将自己的启动堆内存变成4G



从proxy-service拉取的ip有重复的，自己重新自己拉取，并且，做好ip拉取上限告警

ip池中的ProxyIp可以和IpMonitor可以合并到一起, 就不用同步ip池中的ip和监控记录表里面的ip的状态了.

1.ip池

如果服务中断, ip池数量会满了不会变化, 因为失效的ip不会被poll, 所以就一直存在里面, 然后程序检测有效ip不足, 就会往里面添加第二批有效的ip, 当第二批也失效, 就会循环添加,一直到最后, ip池可能可能因为没有释放掉, 而导致内存泄露

### 待解决问题

edx销量,跑隧道成功率很低,需要查看整个请求的流程,对一下请求失败的url的这个流程.  那边有风控,后续讨论

观察优量的运行情况

adx-replay观察统计请求量,做一个请求量的估算,以及查看代码中的定时任务的运行逻辑是否是串行的,然后估算出现在的请求量后, 需要在这个在这个基础上再做一次请求量的提升



# 爬虫请求,广告量统计

| 编号 | app        | 每小时请求量(成功) | 每小时请求量(失败) | 总请求量 | 每小时广告量 |
| ---- | ---------- | ------------------ | ------------------ | -------- | ------------ |
| 17   | 腾讯视频   | 24W                | 4w                 | 28W      | 23W          |
| 3    | 天天快报   | 15W                | 5w                 | 20W      | 5.5W         |
| 91   | QQ浏览器   | 13W                | 1w                 | 14W      | 1.7W         |
| 85   | 穿山甲联盟 | 50W                | 13w                | 63W      | 140W         |
| 84   | 优量广告   | 40W                | 8W                 | 48W      | 25W          |



# 问题



### TCP连接CLOSE_WAIT状态数过多

1.wireshark 抓包分析两次建立连接过程, 第一次调用方和隧道建立连接, 三次握手, 四次挥手正常. 第二次隧道和代理ip建立连接, 三次握手正常, 四次挥手异常, 被关闭方(ps: 可以是隧道,可以是代理商)偶尔会进入CLOSE_WAIT状态(ps: 连接代理ip失败的情况下才会出现, 因为95%以上都是连接成功的, 很难发现).

2.[linux参数调优](https://blog.csdn.net/dandan2zhuzhu/article/details/78413946)



### 打开文件描述符过多

1.先确定进程打开的文件描述符是什么类型,大部分都是 socket 类型, 所以可以确定是连接未正常关闭

2.采用 okhttp client 代替 netty client 发送请求,发现文件描述符回归正常

3.再次检查代码,发现 netty clien 没有在连接代理ip失败的情况下,关闭sockt连接

```shell
查看服务启动后占用的句柄数
cd /proc/5434/fd | ll | wc -l     (注: 5434为进程号)
或者 lsof -p 10771 | wc -l

建立的连接数
netstat -n | grep 21332 | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}' 

查看全连接队列
ss -lnt|grep 'Recv-Q\|21332'  (注: 21332为socket监听端口号)
```

参考:

[netty报Too many open files了（必看）看完将弄明白tcp通讯过程](https://blog.csdn.net/cowbin2012/article/details/110689676)



### unable to create new native thread

这个错误是多个服务的进程使用同一个用户，给部署到了一台机器上，然后每个进程下各自启动的线程数，会接近1000个左右的数量，4个服务加起来会到4000左右，但是机器的默认线程开启的线程数为4096, 所以导致不能创建新的线程，然后开始报如下错误：

```
[2022-05-18 13:14:08] [nioEventLoopGroup-3-122] [ReqMonitorUtils.java:cost:40] [INFO ] -> 0 ms, false, youliang, apnproxy.forward, 59.59.163.80:4213, unable to create new native thread, null, null
```

隧道服务新接收的请求就会一直占用socket文件句柄，但是却不能有正常的新的线程去处理请求，所以由于线程资源达到限制4096，但是又没有新的线程可以被创建，最终导致报错：open too many files



### ByteBuf.release() was not called

1.通过zabbix查看机制资源使用情况。tcp连接数正常，内存使用到警戒线。

![image-20220518145220829](C:\Users\caiguanghui\AppData\Roaming\Typora\typora-user-images\image-20220518145220829.png)



2.阿里云观察机器CPU，内存，磁盘读写，带宽大小均正常。

![image-20220518145445273](C:\Users\caiguanghui\AppData\Roaming\Typora\typora-user-images\image-20220518145445273.png)

其中带宽大小相比较与另外一个进程（如下图所示）的带宽使用量正常。

![image-20220518145644141](C:\Users\caiguanghui\AppData\Roaming\Typora\typora-user-images\image-20220518145644141.png)



3.再使用top -p 16625 （回车后，按大写H）查看进程内部的线程运行情况，看到所有的线程都处于sleeping状态

![image-20220518143305666](C:\Users\caiguanghui\AppData\Roaming\Typora\typora-user-images\image-20220518143305666.png)

4.查看请求运行日志，发现问题所在，日志报错：failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912)

![image-20220518143647425](C:\Users\caiguanghui\AppData\Roaming\Typora\typora-user-images\image-20220518143647425.png)

```shell script
[2022-05-18 14:24:49] [nioEventLoopGroup-3-336] [ReqMonitorUtils.java:cost:40] [INFO ] -> 1 ms, false, pangolin, apnproxy.forward, 113.141.222.56:4231, failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912), null, null
[2022-05-18 14:24:50] [nioEventLoopGroup-3-337] [ReqMonitorUtils.java:cost:40] [INFO ] -> 1 ms, false, pangolin, apnproxy.schema, 59.59.158.95:4231, failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912), null, null
[2022-05-18 14:24:50] [nioEventLoopGroup-3-337] [ReqMonitorUtils.java:cost:40] [INFO ] -> 1 ms, false, pangolin, apnproxy.forward, 59.59.158.95:4231, failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912), null, null
[2022-05-18 14:24:51] [nioEventLoopGroup-3-338] [ReqMonitorUtils.java:cost:40] [INFO ] -> 0 ms, false, pangolin, apnproxy.schema, 113.228.108.54:4231, failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912), null, null
[2022-05-18 14:24:51] [nioEventLoopGroup-3-338] [ReqMonitorUtils.java:cost:40] [INFO ] -> 0 ms, false, pangolin, apnproxy.forward, 113.228.108.54:4231, failed to allocate 16777216 byte(s) of direct memory (used: 520093703, max: 536870912), null, null
```

堆外内存不够分配，导致不能正常处理请求（netty零拷贝机制），导致该结果的原因为如下（主控制台启动日志里面报这个错误），所以可能是代码没有释放对外内存的引用。

```shell script
io.netty.util.ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.
Recent access records: 
Created at:
	io.netty.buffer.SimpleLeakAwareByteBuf.unwrappedDerived(SimpleLeakAwareByteBuf.java:143)
	io.netty.buffer.SimpleLeakAwareByteBuf.readRetainedSlice(SimpleLeakAwareByteBuf.java:67)
	io.netty.handler.codec.http.HttpObjectDecoder.decode(HttpObjectDecoder.java:336)
	io.netty.handler.codec.http.HttpServerCodec$HttpServerRequestDecoder.decode(HttpServerCodec.java:123)
	io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:508)
	io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:447)
	io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:276)
	io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)
	io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)
	io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)
	io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)
	io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)
	io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719)
	io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
	io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	java.lang.Thread.run(Thread.java:750) 
```

5.最后检查代码



# okhttp 转发 https

### SSL证书生成

```shell
第一步: 生成Netty服务端私钥和证书仓库命令，用于将客户端的证书保存到服务端的授信证书仓库中 
keytool -genkey -alias securechat -keysize 2048 -validity 365 -keyalg RSA -dname "CN=localhost" -keypass 123456 -storepass 123456 -keystore tunnel-server.jks
 
第二步：生成Netty服务端自签名证书 用于颁给使用者 从 证书仓库中导出证书
keytool -export -alias securechat -keystore tunnel-server.jks -storepass 123456 -file tunnel-server.cer
 
第三步：生成客户端的私钥和证书仓库，用于将服务端的证书保存到客户端的授信证书仓库中 
keytool -genkey -alias smcc -keysize 2048 -validity 365  -keyalg RSA -dname "CN=localhost" -keypass 123456  -storepass 123456 -keystore tunnel-client.jks
 
第四步: 生成客户端自签名证书
keytool -export -alias smcc -keystore tunnel-client.jks -storepass 123456 -file tunnel-client.cer
 
第五步：将Netty服务端证书导入到客户端的证书仓库中
keytool -import -trustcacerts -alias securechat -file tunnel-server.cer -storepass 123456 -keystore tunnel-client.jks
 
第六步:将客户端的自签名证书导入到服务端的信任证书仓库中：
keytool -import -trustcacerts -alias smcc -file tunnel-client.cer -storepass 123456 -keystore tunnel-server.jks
 
 
-keysize 2048 密钥长度2048位（这个长度的密钥目前可认为无法被暴力破解）
-validity 365 证书有效期365天
-keyalg RSA 使用RSA非对称加密算法
-dname "CN=localhost" 设置Common Name为localhost
-keypass 123456 密钥的访问密码为123456
-storepass 123456 密钥库的访问密码为123456（其实这两个密码也可以设置一样，通常都设置一样，方便记）
-keystore tunnel-server.jks 指定生成的密钥库文件为tunnel-server.jks 
```



# 监控

### 日常监控命令

```shell
------------------- ip监控 -------------------------
tail -f adx-IpMonitorUtils.log | grep "success percent"
grep "成功移除ip	" adx-IpMonitorUtils.log | wc -l
grep "今日累计拉取" adx-ZhiMaFetchServiceImpl.log

------------------- 请求监控 ------------------------
grep "success percent" adx-ReqMonitorUtils.log | tail -5 | grep "success percent"

---------------------- 风控 ---------------------------
tail -f adx-ConcurrentLimitHandler.log | grep "connections"

------------------- ip池 ------------------------------
tail -f adx-IpPoolScheduleService.log | grep "tunnel="

------------------- 查看机器总的tcp连接状态数 ------------------------------
netstat -anpt | wc -l
netstat -anpt | grep "CLOSE_WAIT" | wc -l
```



### 监控TCP连接数, CLOSE_WAIT状态数, 打开文件描述符个数, 并发送告警邮件

```shell
#!/bin/bash

#netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}'

DATETIME=`date +%Y%m%d-%H%M%S`

TCP_CLOSE_WAIT_COUNT=`netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}' | awk '/^CLOSE_WAIT/ {print $2}'`
TCP_TOTAL_COUNT=`netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}' | awk '{sum+=$2} END {print sum}'`
PID=`/usr/local/jdk1.8.0_131/bin/jps -l | grep 'tunnel-proxy-service' | awk '{print $1}'`
ULIMIT_COUNT=`ls -l /proc/${PID}/fd 2>/dev/null | wc -l`

#echo ${TCP_CLOSE_WAIT_COUNT}
#echo ${TCP_TOTAL_COUNT}
#echo ${PID}
#echo ${ULIMIT_COUNT}


function send_mail(){
    serverName=`hostname`
    sendMsg=TCP%20Connections%20too%20many%20on%20${serverName}
    url="http://172.18.248.80/innerservice/mail/send?subject=Tcp%20Connections%20Alert&content=${sendMsg}&to=chenghuajie@dataeye.com,wangchaojia@dataeye.com&isMime=false&needReceipt=false"
    curl ${url}
}


if [[ ${TCP_CLOSE_WAIT_COUNT} -ge 30000 ]] || [[ ${TCP_TOTAL_COUNT} -ge 50000 ]] || [[ ${ULIMIT_COUNT} -ge 50000 ]];then
   netstat -n | awk '/^tcp/ {++y[$NF]} END {for(w in y) print w, y[w]}' > /data0/logs/tunnel-proxy/monitor-tcp-${DATETIME}.log
   /usr/sbin/lsof -p ${PID} > /data0/logs/tunnel-proxy/monitor-lsof-${DATETIME}.log 2>/data0/logs/tunnel-proxy/monitor-lsof-error.log
   mv /data0/logs/tunnel-proxy/console.log /data0/logs/tunnel-proxy/monitor-console.log-${DATETIME}
   ## send mail and restart app
   /usr/local/htdocs/tunnel-proxy/shell/deploy-restart.sh restart
   send_mail
fi
```





### 命令

> 统计错误请求有多少个，以及每个错误占用有多少

```shell
cat adx-ReqMonitorUtils.log | grep 'false, pangolin' | awk -F ', ' '{print($2,$6)}' |awk -F '!' '{count[$1]++} END {for(i in count ){print(i,count[i])}}'
```

> 统计不同的ip+port有多少个

```shell
cat adx-IpMonitorUtils.log | grep "ip=" | grep -E '^\[2022-04-24 1[1-9]' | awk -F= ' {print($2)}' | awk -F, '{print $1}' | awk -F: '{print $1}'| sort | uniq -c  |wc -l
```



# 其他

win10 杀死端口占用的进程
查看所有进程：netstat -nao
查找指定端口进程： netstat -nao|find "8080" （这里的8080指要查找的端口号）
终止指定PID进程：taskkill /pid 8548 -F（这里的8548指要终止进程对应的PID号）



# 隧道配置

### 代理IP

```shell
经过ip性能测试,以及性价比比对,最终采用芝麻和游杰的代理ip
实测使用一个345kb的请求, 测出芝麻代理1个IP，20并发，带宽6MB左右为极限, 所以真实定制规则取一半，算作1个ip，10个并发，3MB带宽。
```



### 优量广告

```shell
请求方: 每秒 150-200 个请求(平均https请求30个左右), 每小时 54-72W 请求(平均60W左右), 每天 1296-1728W 个请求(平均1500W左右), 每个请求响应大小20KB-60KB(平均40KB左右, https会达到530KB), 每秒带宽12MB, https会达到530KB
隧道方: 一个隧道10个ip, 300TPS限制, 堆内存2G, 堆外直接内存2G, YoungGC 频繁, 没有 FullGC
阿里云机器: 16核CPU, 32G运存, 25Mbps带宽跑满
adx-crawl-007   172.18.211.168  120.25.162.186   16/32G  
adx-crawl-008   172.18.211.169  120.79.147.167   16/32G
```

### edx-sale

```shell
3千万请求一天 1kb以下 EDX 销量更新
edx-sale：每小时30w个请求，每秒83个请求，每个请求4KB

隧道方: 
请求方: 每小时30w个请求，每秒83个请求，每个请求4KB。
阿里云机器:  
adx-crawl-008   172.18.211.169  120.79.147.167   16/32G
```



# 技术分享

### netty为什么高性能

1. 异步非阻塞通信
2. 零拷贝
3. 内存池
4. 高效的reactor线程模型
5. 无锁化的串行设计概念
6. 高效的并发编程
7. 高性能的序列化框架
8. 灵活的TCP参数配置能力

参考: [Netty------为什么Netty性能如此之高？](https://blog.csdn.net/qqq3117004957/article/details/106435076/)



### netty架构设计

### 常见协议支持

协议说明，如何支持http，https，socks5协议的，socks5协议的概述，以及好处

### 后续隧道优化

优化ip的平均使用率：新加入的ip后续会出现使用率很低，导致浪费ip的有效时间。

请求成功率：细化ip失败的原因列表，请求失败的原因列表，确保用少量ip达到高质量的请求成功率。

调研并扩展socks5协议：



# 账号密码

### mysql

```sql
# SSH通道
主机：120.77.156.230
端口：2222
用户名：wangchaojia
密码：aJ7gzbKcmiru6

#------------------------------------------------------------ dev -------------------------------------------------------------
# tunnel_proxy(dev)
主机：10.1.9.5
端口：3306
数据库：ip_tunnel
用户名：crawl
密码：.Y8yH1KmxwwhE
# adx_replay(dev)
主机：10.1.9.5
端口：3306
数据库：adx-crawl所有开发环境库
用户名：root
密码：DataEye2020@mysql

#------------------------------------------------------------ product -------------------------------------------------------------
# tunnel_proxy(product)
主机：pc-wz9w28e2h23788p5o.rwlb.rds.aliyuncs.com
端口：3306
数据库：ip_tunnel
用户名：tunnel_proxy
密码：uBvH#v4YOyF-A

# ad_adx(product)
主机：pc-wz96077e77bktj328.rwlb.rds.aliyuncs.com
端口：3306
数据库：ad_adx
用户名：readonly
密码：G9KjWYDg+&-TVlE
```


```shell script
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.port=12345
-Djava.rmi.server.hostname=10.1.2.201
-Dio.netty.leakDetectionLevel=paranoid
```
